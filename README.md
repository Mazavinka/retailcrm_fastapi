# FastAPI RetailCRM (Test Task)

## Описание проекта

Данный проект представляет собой REST API сервис на **FastAPI**, который взаимодействует с **RetailCRM API v5**.  
Сервис реализует базовые операции работы с клиентами, заказами и платежами и выступает в роли прокси-слоя между клиентом и RetailCRM.

Проект выполнен в рамках тестового задания на позицию Python-разработчика.

---

## Функциональность

Реализованы следующие возможности:

### Клиенты
- Получение списка клиентов из RetailCRM
- Фильтрация клиентов по:
  - имени
  - email
  - дате регистрации
- Создание нового клиента

### Заказы
- Получение списка заказов клиента по ID клиента
- Создание нового заказа

### Платежи
- Создание и привязка платежа к заказу

---

## Используемые технологии

- Python 3.11+
- FastAPI
- httpx (async)
- Pydantic
- Docker
- docker-compose

---

## Особенности реализации

- Используется асинхронный HTTP-клиент **httpx** для взаимодействия с RetailCRM API.
- Данные для RetailCRM передаются в формате `application/x-www-form-urlencoded`, так как RetailCRM API не принимает JSON body напрямую.
- Вложенные структуры (`customer`, `order`, `payment`) сериализуются в JSON-строку.
- Реализована базовая обработка ошибок внешнего API:
  - обработка сетевых ошибок
  - обработка HTTP-статусов
- Более сложная архитектура и расширенная обработка ошибок сознательно не реализовывались, чтобы не усложнять решение в рамках тестового задания.

---

## Переменные окружения

Перед запуском необходимо создать файл `.env` в корне проекта:

```env
BASE_URL=https://yourdomain.retailcrm.ru
RETAILCRM_API_KEY=your_api_key_here
```

## Запуск проекта локально

1. Создать и активировать виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux
venv\Scripts\activate     # Windows
```
2. Установить зависимости:
```bash
pip install -r requirements.txt
```

3. Запустить сервер:
```bash
uvicorn app.main:app --reload
```

4. Открыть Swagger UI:
```bash
http://127.0.0.1:8000/docs
```

## Запуск через Docker
В проекте используется Dockerfile для сборки образа приложения.
```bash
docker build -t retailcrm-fastapi .
docker run -p 8000:8000 --env-file .env retailcrm-fastapi
```
После запуска приложение будет доступно по адресу:
```bash
http://127.0.0.1:8000/docs
```

## Запуск через docker-compose
Для удобного запуска используется docker-compose.
```bash
docker compose up --build
```
После запуска приложение будет доступно по адресу:
```bash
http://127.0.0.1:8000/docs
```

## Основные сложности при реализации
- Особенностью RetailCRM API является использование формата application/x-www-form-urlencoded и необходимость передачи вложенных структур в виде JSON-строк.
- API не принимает стандартный JSON body, что потребовало дополнительного слоя сериализации данных.
- Для упрощения архитектуры и в рамках тестового задания была реализована минимальная, но достаточная обработка ошибок внешнего API.

## Комментарии
Проект реализован с упором на читаемость, простоту и соответствие требованиям тестового задания.
Более сложные архитектурные решения (выделение отдельных клиентов, middleware, расширенная обработка ошибок) сознательно не использовались, так как они не являлись целью данного задания.